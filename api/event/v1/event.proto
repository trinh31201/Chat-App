syntax = "proto3";

package api.event.v1;

import "google/api/annotations.proto";

option go_package = "github.com/yourusername/chat-app/api/event/v1;v1";

// Event service for managing events and calendar integration
service EventService {
  // Create a new event
  rpc CreateEvent(CreateEventRequest) returns (Event) {
    option (google.api.http) = {
      post: "/api/v1/events"
      body: "*"
    };
  }

  // Get event by ID
  rpc GetEvent(GetEventRequest) returns (Event) {
    option (google.api.http) = {
      get: "/api/v1/events/{id}"
    };
  }

  // List events for a room or user
  rpc ListEvents(ListEventsRequest) returns (ListEventsResponse) {
    option (google.api.http) = {
      get: "/api/v1/events"
    };
  }

  // Update an event
  rpc UpdateEvent(UpdateEventRequest) returns (Event) {
    option (google.api.http) = {
      put: "/api/v1/events/{id}"
      body: "*"
    };
  }

  // Delete an event
  rpc DeleteEvent(DeleteEventRequest) returns (DeleteEventResponse) {
    option (google.api.http) = {
      delete: "/api/v1/events/{id}"
    };
  }

  // RSVP to an event
  rpc RsvpEvent(RsvpEventRequest) returns (RsvpEventResponse) {
    option (google.api.http) = {
      post: "/api/v1/events/{event_id}/rsvp"
      body: "*"
    };
  }

  // Detect events from message text
  rpc DetectEvents(DetectEventsRequest) returns (DetectEventsResponse) {
    option (google.api.http) = {
      post: "/api/v1/events/detect"
      body: "*"
    };
  }

  // Sync event to external calendar
  rpc SyncToCalendar(SyncToCalendarRequest) returns (SyncToCalendarResponse) {
    option (google.api.http) = {
      post: "/api/v1/events/{event_id}/sync"
      body: "*"
    };
  }
}

// Event model
message Event {
  int64 id = 1;
  int64 room_id = 2;
  int64 message_id = 3;
  int64 created_by = 4;
  string title = 5;
  string description = 6;
  int64 event_date = 7; // Unix timestamp
  int64 end_date = 8; // Unix timestamp, optional
  string location = 9;
  string event_type = 10; // meeting, reminder, deadline, appointment
  string status = 11; // active, cancelled, completed
  float detection_confidence = 12; // 0.0-1.0
  bool auto_detected = 13;
  bool calendar_synced = 14;
  string external_calendar_id = 15;
  repeated EventAttendee attendees = 16;
  int64 created_at = 17;
  int64 updated_at = 18;
}

// Event attendee model
message EventAttendee {
  int64 id = 1;
  int64 event_id = 2;
  int64 user_id = 3;
  string username = 4; // For display purposes
  string status = 5; // pending, accepted, declined, maybe
  int64 response_at = 6; // Unix timestamp
  int64 created_at = 7;
}

// Request/Response messages
message CreateEventRequest {
  int64 room_id = 1;
  int64 message_id = 2; // Optional, if creating from a message
  string title = 3;
  string description = 4;
  int64 event_date = 5; // Unix timestamp
  int64 end_date = 6; // Unix timestamp, optional
  string location = 7;
  string event_type = 8;
  repeated int64 attendee_user_ids = 9; // User IDs to invite
}

message GetEventRequest {
  int64 id = 1;
}

message ListEventsRequest {
  int64 room_id = 1; // Optional, filter by room
  int64 user_id = 2; // Optional, filter by user
  string status = 3; // Optional, filter by status
  int64 start_date = 4; // Optional, filter events after this date
  int64 end_date = 5; // Optional, filter events before this date
  int32 limit = 6;
  int32 offset = 7;
}

message ListEventsResponse {
  repeated Event events = 1;
  int32 total = 2;
}

message UpdateEventRequest {
  int64 id = 1;
  string title = 2;
  string description = 3;
  int64 event_date = 4;
  int64 end_date = 5;
  string location = 6;
  string event_type = 7;
  string status = 8;
}

message DeleteEventRequest {
  int64 id = 1;
}

message DeleteEventResponse {
  bool success = 1;
}

message RsvpEventRequest {
  int64 event_id = 1;
  string status = 2; // accepted, declined, maybe
}

message RsvpEventResponse {
  bool success = 1;
  EventAttendee attendee = 2;
}

// Event detection from messages
message DetectEventsRequest {
  string text = 1;
  int64 room_id = 2;
  int64 message_id = 3; // Optional, if detecting from existing message
}

message DetectEventsResponse {
  repeated DetectedEvent detected_events = 1;
}

message DetectedEvent {
  string title = 1;
  string description = 2;
  int64 event_date = 3;
  int64 end_date = 4;
  string location = 5;
  string event_type = 6;
  float confidence = 7; // 0.0-1.0
  string extracted_text = 8; // The text that triggered the detection
}

// Calendar sync
message SyncToCalendarRequest {
  int64 event_id = 1;
  string calendar_provider = 2; // google, outlook, ical
  string calendar_id = 3; // Optional, specific calendar ID
}

message SyncToCalendarResponse {
  bool success = 1;
  string external_calendar_id = 2;
  string calendar_url = 3;
}